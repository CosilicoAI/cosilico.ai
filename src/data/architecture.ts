import { Layer, Flow } from "./types";

export const layers: Layer[] = [
  {
    id: "sources",
    name: "Legal Text Sources",
    description: "Raw legal documents from government sources",
    color: "#ef4444",
    components: [
      {
        id: "usc",
        name: "US Code",
        description: "Federal statutes (Title 26 = Internal Revenue Code)",
        storage: "files",
        outputs: ["Statute sections", "Cross-references", "Amendment history"],
        details: [
          "XML format (USLM schema)",
          "Updated continuously",
          "Public domain",
        ],
      },
      {
        id: "cfr",
        name: "Regulations (CFR)",
        description: "Federal regulations implementing statutes",
        storage: "files",
        outputs: ["Regulatory text", "Agency guidance", "Effective dates"],
        details: [
          "eCFR provides daily updates",
          "Links to authorizing statutes",
        ],
      },
      {
        id: "state",
        name: "State Codes",
        description: "50 state tax and benefit codes",
        storage: "files",
        outputs: ["State statutes", "State regulations"],
        details: ["Varying formats", "Different update frequencies"],
      },
      {
        id: "guidance",
        name: "Agency Guidance",
        description: "Forms, manuals, rulings",
        storage: "files",
        outputs: ["Tax forms", "Program manuals", "Revenue rulings"],
        details: ["IRS forms & instructions", "SSA POMS", "State handbooks"],
      },
    ],
  },
  {
    id: "knowledge",
    name: "Legal Knowledge Graph",
    description: "Structured representation with semantic understanding",
    color: "#f59e0b",
    components: [
      {
        id: "statute-db",
        name: "Statute Database",
        description: "Hierarchical storage of all legal text",
        storage: "both",
        inputs: ["Raw legal text"],
        outputs: ["Structured sections", "Citation graph"],
        details: [
          "Title → Chapter → Section hierarchy",
          "Cross-reference extraction",
          "Bi-temporal: enacted + effective date",
        ],
      },
      {
        id: "semantic",
        name: "Semantic Annotations",
        description: "Computational meaning from legal text",
        storage: "files",
        inputs: ["Statute sections"],
        outputs: ["Annotated sections"],
        details: [
          "Intent: threshold, rate, eligibility",
          "Entity refs: taxpayer, dependent",
          "Conditions and exceptions",
        ],
      },
    ],
  },
  {
    id: "rules",
    name: "Rules Engine",
    description: "Executable policy rules with multi-target compilation",
    color: "#10b981",
    components: [
      {
        id: "dsl",
        name: "Cosilico DSL",
        description: "Domain-specific language for policy rules",
        storage: "files",
        inputs: ["Legal knowledge"],
        outputs: ["Rule definitions"],
        details: [
          "Safe for untrusted users",
          "Mandatory citations",
          "Entity + period types",
          "Git-versioned, AI-editable",
        ],
      },
      {
        id: "compiler",
        name: "Multi-Target Compiler",
        description: "Compiles rules to execution targets",
        storage: "files",
        inputs: ["Rule definitions"],
        outputs: ["Python", "JavaScript", "SQL", "Spark"],
        details: [
          "Intermediate Representation",
          "Vectorization for microsim",
          "Scalar for households",
        ],
      },
      {
        id: "parameters",
        name: "Parameter System",
        description: "Time-varying parameters with provenance",
        storage: "files",
        inputs: ["Legal text", "IRS publications"],
        outputs: ["Typed parameters"],
        details: [
          "Bi-temporal: effective + vintage",
          "YAML with citations",
          "Inflation adjustments",
        ],
      },
    ],
  },
  {
    id: "filesystem",
    name: "Filesystem Layer",
    description: "Local files for AI agent workflows",
    color: "#06b6d4",
    components: [
      {
        id: "sync",
        name: "CLI Sync",
        description: "Bidirectional sync: cloud ↔ local files",
        storage: "both",
        inputs: ["Cloud DB"],
        outputs: ["Local YAML/markdown"],
        details: [
          "cosilico pull / push / status",
          "Conflict detection",
          "OAuth device flow",
        ],
      },
      {
        id: "local-files",
        name: "Local File Structure",
        description: "AI-native data representation",
        storage: "files",
        outputs: ["Structured directories"],
        details: [
          "statutes/ - law as markdown",
          "rules/ - DSL files (.cosilico)",
          "parameters/ - YAML with citations",
          "Git versioning for all changes",
        ],
      },
      {
        id: "ai-editing",
        name: "AI Agent Editing",
        description: "Claude, Cursor, Copilot can edit directly",
        storage: "files",
        inputs: ["Local files"],
        outputs: ["Modified files"],
        details: [
          "Read full context",
          "Surgical edits with diffs",
          "Review before commit",
          "PR workflow for changes",
        ],
      },
    ],
  },
  {
    id: "data",
    name: "Microdata Layer",
    description: "Population data for microsimulation",
    color: "#6366f1",
    components: [
      {
        id: "survey",
        name: "Survey Data",
        description: "Representative population samples",
        storage: "files",
        outputs: ["Household records", "Person records", "Weights"],
        details: ["CPS, ACS, SCF, CE", "State-level oversamples"],
      },
      {
        id: "synthetic",
        name: "Synthetic Populations",
        description: "ML-generated representative populations",
        storage: "files",
        inputs: ["Survey data", "Admin totals"],
        outputs: ["Synthetic households"],
        details: ["Privacy-preserving", "Local calibration"],
      },
      {
        id: "imputation",
        name: "Imputation Engine",
        description: "ML-based variable imputation",
        storage: "db",
        inputs: ["Partial data"],
        outputs: ["Complete records"],
        details: ["Customer data enrichment", "Uncertainty quantification"],
      },
    ],
  },
  {
    id: "simulation",
    name: "Simulation Engine",
    description: "Execute rules at any scale",
    color: "#8b5cf6",
    components: [
      {
        id: "household",
        name: "Household Calculator",
        description: "Single-household calculations",
        storage: "db",
        inputs: ["Household inputs", "Compiled rules"],
        outputs: ["Tax/benefit results", "Audit trail"],
        details: ["< 100ms latency", "Full explanation trace"],
      },
      {
        id: "microsim",
        name: "Microsimulation",
        description: "Census-scale population modeling",
        storage: "db",
        inputs: ["Microdata", "Compiled rules"],
        outputs: ["Distributional impacts", "Revenue estimates"],
        details: ["100M+ households", "Parallel execution"],
      },
    ],
  },
  {
    id: "ai",
    name: "AI Layer",
    description: "Automated encoding and generation",
    color: "#ec4899",
    components: [
      {
        id: "encoder",
        name: "AI Encoder",
        description: "Bill text → Cosilico rules",
        storage: "files",
        inputs: ["Bill text", "Affected statutes"],
        outputs: ["Draft rules", "Test cases"],
        details: [
          "Generates local DSL files",
          "Human review via git diff",
          "Confidence scores",
        ],
      },
      {
        id: "generator",
        name: "Legislative Generator",
        description: "Cosilico reform → Bill text",
        storage: "files",
        inputs: ["Reform definition", "Source statutes"],
        outputs: ["Draft legislation", "Fiscal note"],
        details: [
          "Amendment language",
          "Section references",
          "Microsim-based fiscal impact",
        ],
      },
    ],
  },
  {
    id: "api",
    name: "API Layer",
    description: "Interface for AI systems and applications",
    color: "#0066ff",
    components: [
      {
        id: "rest",
        name: "REST API",
        description: "HTTP endpoints for all operations",
        storage: "db",
        inputs: ["API requests"],
        outputs: ["JSON responses"],
        details: [
          "Calculate taxes/benefits",
          "Run microsimulations",
          "Query statutes",
        ],
      },
      {
        id: "tools",
        name: "AI Tool Interface",
        description: "Function calling for AI agents",
        storage: "db",
        inputs: ["Tool calls"],
        outputs: ["Structured results"],
        details: ["OpenAI function format", "Anthropic tool use", "MCP server"],
      },
    ],
  },
];

export const flows: Flow[] = [
  {
    id: "bill-to-sim",
    name: "Bill → Simulation",
    description: "New legislation automatically becomes simulatable",
    steps: [
      {
        component: "guidance",
        action: "New bill introduced",
        data: "H.R. 1234",
      },
      {
        component: "statute-db",
        action: "Identify affected sections",
        data: "IRC § 32, § 24",
      },
      {
        component: "encoder",
        action: "AI generates draft rules",
        data: "Local .cosilico files",
      },
      {
        component: "local-files",
        action: "Human reviews via git diff",
        data: "PR workflow",
      },
      {
        component: "compiler",
        action: "Compile to targets",
        data: "Python, JS",
      },
      {
        component: "microsim",
        action: "Run population impact",
        data: "$2.3B cost",
      },
    ],
  },
  {
    id: "reform-to-bill",
    name: "Reform → Legislation",
    description: "Design policy, generate bill text",
    steps: [
      {
        component: "dsl",
        action: "Define reform in local files",
        data: "Double EITC phase-in",
      },
      { component: "sync", action: "Push to cloud", data: "cosilico push" },
      {
        component: "microsim",
        action: "Model impact",
        data: "5M families affected",
      },
      {
        component: "generator",
        action: "Generate amendment text",
        data: 'Strike "7.65" insert "15.3"',
      },
      {
        component: "local-files",
        action: "Output as local files",
        data: "drafts/hr-1234.md",
      },
    ],
  },
  {
    id: "ai-agent-edit",
    name: "AI Agent Workflow",
    description: "AI edits rules via filesystem",
    steps: [
      { component: "sync", action: "Pull latest", data: "cosilico pull" },
      {
        component: "ai-editing",
        action: "Claude edits parameters",
        data: "Update 2025 brackets",
      },
      {
        component: "local-files",
        action: "Review diff",
        data: "git diff parameters/",
      },
      { component: "sync", action: "Push changes", data: "cosilico push" },
      {
        component: "rest",
        action: "API uses new values",
        data: "/calculate?year=2025",
      },
    ],
  },
];
